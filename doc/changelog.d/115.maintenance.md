Fix: update typing annotations and fix linter errors.